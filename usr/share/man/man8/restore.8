.\" This manpage source uses rsml coding. 
.so /usr/share/lib/tmac/sml
.so /usr/share/lib/tmac/rsml
.\"
.\"
.\" *********************************************************************
.\" *                                                                   *
.\" *      Copyright (c) Digital Equipment Corporation, 1991, 1994      *
.\" *                                                                   *
.\" *                       All Rights Reserved.                        *
.\" *                                                                   *
.\" *********************************************************************
.\"
.\"
.\" HISTORY
.\"
.\" @(#)$RCSfile: restore.8,v $ $Revision: 3.2.7.3 $ (DEC) $Date: 1993/12/07 21:39:00 $
.\"
.\" 
.\" (c) Copyright 1991, OPEN SOFTWARE FOUNDATION, INC.
.\" ALL RIGHTS RESERVED
.\" 
.\" nm_07.08.90
.\" hah_02.10.90
.TH restore 8
.SH NAME
\*Lrestore\*O, \*Lrrestore\*O \- Restores files from tapes written with the \*Ldump\*O or \*Lrdump\*O command, respectively
.SH SYNOPSIS
.PP
.iX "restore"
.iX "rrestore"
.iX "tape" "restoring"
.iX "tape" "reading"
.iX "files" "read to tape"
.iX "files" "local"
.iX "files" "remote"
.iX "tape" "remote"
.iX "remote" "files"
.iX "remote" "tape"
.iX "restore" "function flags"
.iX "restore" "modifier flags"
.iX "flags" "restore modifier"
.iX "flags" "restore function"
.iX "function flags" "restore"
.iX "modifier flags" "restore"
.iX "server" "remote"
.iX "remote" "server"
.iX "restoration" "files" "interactive"
.iX "interactive file restoration"
.iX "commands" "shell-like"
.iX "directory" "default"
.iX "directory" "current"
.iX "default" "directory"
.iX "current directory"
.iX "inode" "number"
.iX "number" "inode"
.iX "file" "restore" "pathname"
.iX "pathname" "file restoration"
.iX "commands" "interactive restore"
.iX "restore" "interactive commands"
.iX "files" "list" "to restore"
.iX "files" "list" "to delete"
.iX "read" "files from tape"
.iX "tape" "volume to mount"
.iX "mode" "tape access"
.iX "tape access mode"
.iX "directory" "owner"
.iX "files" "cleanup"
.iX "restore" "file cleanup"
.iX "tape" "header information"
.iX "information" "tape header"
.iX "list" "files to read"
.iX "debugging" "restore mode"
.iX "mode" "debugging" "restore"
.iX "dump" "complete"
.iX "complete dump"
.iX "file system" "empty"
.iX "empty file system"
.iX "files" "delete"
.iX "delete files"
.iX "files" "read"
.iX "read files"
.iX "mode" "set"
.iX "set modes"
.iX "inode numbers"
.iX "numbers" "inode"
.iX "restore" "complete"
.iX "complete restore"
.iX "tape" "multivolume"
.iX "multivolume tape"
.iX "directory" "root"
.iX "root directory"
.iX "tape" "recursive search"
.iX "recursive tape search"
.iX "flags" "modifier"
.iX "modifier flags"
.iX "tape" "block size"
.iX "block size" "tape"
.iX "tape" "determining size"
.iX "tape" "old-style dump"
.iX "old-stype dump tape"
.iX "mode" "debug"
.iX "debug" "mode"
.iX "restore" "internal checks"
.iX "device" "tape archive"
.iX "device" "default tape"
.iX "default" "tape device"
.iX "tape" "block size"
.iX "block size" "tape"
.iX "file" "dump"
.iX "dump" "file"
.iX "tape" "volume number"
.iX "volume number" "tape"
.iX "tape" "restore error recovery"
.iX "error" "tape" "recovery from"
.iX "restore" "from directory"
.iX "directory" "tape restore"
.iX "number" "inode"
.iX "inode" "number"
.iX "pathname" "file"
.iX "file" "pathname"
.iX "file" "number to restore"
.iX "number" "file to restore"
.iX "restore" "file notify"
.iX "notify" "restored file"
.iX "tape restore error" "abort"
.iX "restore error" "abort"
.iX "tape" "bad blocks"
.iX "bad tape blocks"
.sS
\*L/usr/sbin/restore\*O \*L-\*O[\*Vfunction_flag\*O][\*Vmodifier_flag\*O \&...] [\*Vargument\*O \&...]
.PP
\*L/usr/sbin/rrestore\*O \*L-f\*O \*Vdump_file\*O \*L-\*O[\*Vfunction_flag\*O][\*Vmodifier_flag\*O \&...] [\*Vargument\*O \&...]
.sE
.PP
The \*Lrestore\*O and \*Lrrestore\*O commands are used to read files
from a local or remote tape, respectively, to local file systems.
.SH "FLAGS"
.PP
.SS "Function Flags"
.VL
.LI "\*L-i\*O"
This flag permits interactive restoration of files read from the
tape.  After reading directory information from the tape
device, the \*Lrestore\*O or \*Lrrestore\*O commands provide a
shell-like interface that allows you to select the files you want to
read.  Some of the interactive commands require as an \*Varg\*O parameter
a subdirectory or filename.  When the \*Varg\*O parameter is unspecified, the
default directory is the current one.  The interactive commands are
explained in the following list:
.VL
.LI "\*Lls\*O [\*Varg\*O]"
.\" Begin Digital-specific information CORRECTION
.\" Removed extra 'the' per QAR 6887.
Lists files in the current directory or the directory specified
.\" End Digital-specific information CORRECTION
with the \*Varg\*O parameter.  Directory entries are appended with a
\*L/\*O (slash) character.  Entries that have been marked for reading
are prepended with a \*L*\*O (asterisk) character.  When the \*L-v\*O
modifier flag is used, the inode number of each entry is also listed.
.LI "\*Lcd\*O [\*Varg\*O]"
Changes the current directory to the directory specified with the \*Varg\*O
parameter.
.LI "\*Lpwd\*O"
Prints the pathname of the current directory to the standard output device.
.LI "\*Ladd\*O [\*Varg\*O]"
Adds the files in the current directory or the files specified by
\*Varg\*O to the list of files to be read from the tape
(except when the \*L-h\*O flag is used).  Files on the list of files to be read
are prepended with the \*L*\*O (asterisk) character when they are listed with
the \*Lls\*O interactive command.
.LI "\*Ldelete\*O [\*Varg\*O]"
Deletes all the files in the current directory or the files
specified by the \*Varg\*O parameter from the list of files to be read
from the tape.  Except when the \*L-h\*O flag is specified, all files and
all files in subdirectories of a directory specified with the \*Varg\*O
parameter are deleted.
.IP
An expedient way to select wanted files from any directory whose files
are stored on the tape is to add the directory to the list of files to be
read and then delete the ones that are not wanted.
.LI "\*Lextract\*O"
Reads all files on the list of files to be read from the tape.
The \*Lrestore\*O or \*Lrrestore\*O command asks which volume
you want to mount and whether the access modes of \*L\.\*O (dot)  are
affected.
.IP
A fast way to read a few files from the tape device is to start with
the last volume and work toward the first volume.
.LI "\*Lsetmodes\*O"
Sets owner, access modes, and file creation times for all directories
that have been added to the files-to-read list; nothing is read
from the tape.  This interactive command is useful for cleaning up files after
a \*Lrestore\*O or \*Lrrestore\*O command has been prematurely aborted.
.LI "\*Lverbose\*O"
Toggles the \*L-v\*O modifier (see the \*L-v\*O flag below).  When set,
the verbose flag causes the \*Lls\*O command to list the inode
numbers of all files in the list of files to read.  This interactive
command also causes the \*Lrestore\*O or \*Lrrestore\*O command to
output information about each file to the output device when the file
is read.
.LI "\*Lhelp\*O"
.LI "\*L?\*O"
Lists a summary of the available interactive commands.
.LI "\*Lwhat\*O"
Outputs the tape header information to the standard output
device.
.LI "\*Lquit\*O"
Exits immediately, even when the all the files on list of files to read have
not been read.
.LI "\*Ldebug\*O"
Toggles the debugging mode.
.LI "\*Lxit\*O"
Same as \*Lquit\*O command.
.LE
.LI "\*L-r\*O"
The tape is read and all files are
loaded into the current working directory.  The \*L-r\*O function flag
should only be used to restore a complete dump into an
empty file system, or to restore a previous incremental \*Ldump\*O or
\*Lrdump\*O to the file system after a full level 0 (zero)
restoration of files.  For example:
.iS
/sbin/newfs  /dev/rrz0g  eagle
/sbin/mount  /dev/rz0g  /mnt
cd  mnt
restore  -r
.iE
.IP
These four line entries are a typical sequence of commands to restore a
complete set of files from tape to the disk whose device name is
\*L/dev/rrz0g\*O and whose parameters are described in the
\*L/etc/disktab\*O file under the name \*Leagle\*O.  The file system
name is \*L/dev/rz0g\*O and the directory where the file system is
mounted and to which the files are written from the default tape device is
called \*L/mnt\*O.
.IP
Other \*Lrestore\*O or \*Lrrestore\*O operations may be called to
restore additional files from a previous incremental \*Ldump\*O or
\*Lrdump\*O to the tape device.  Note that the \*Lrestore\*O or
\*Lrrestore\*O process writes a file named \*Lrestoresymtab\*O to the
current directory.  The \*Lrestoresymtab\*O file is used by these
processes to provide information for incremental file restorations
only; this scratch file has no other use and so should be removed when
files from the last incremental storage medium has been restored.
.LI "\*L-R\*O"
The \*Lrestore\*O or \*Lrrestore\*O command requests a particular tape
of a multivolume set on which to restart a full restore (see the
\*L-r\*O flag).  This allows \*Lrestore\*O or \*Lrrestore\*O to be
interrupted and then restarted.
.LI "\*L-t\*O \*Vname\*O \&..."
The files specified by the \*Vname\*O parameter are listed when they are
stored on the tape.  When a \*Vname\*O parameter is not
specified, all files in the root directory stored on the tape
are listed, except when the \*L-h\*O flag is specified.
.LI "\*Lx\*O \*Vname\*O \&..."
The files specified by the \*Vname\*O parameter are read from the
tape device.  When the \*Vname\*O parameter matches a
directory whose contents are stored on the tape, and
the \*L-h\*O flag is not specified, the directory is recursively
searched until all files have been read.  The file owner, time of
modification, and access mode are restored when possible.  When no
file is specified with the \*Vname\*O parameter, the root directory is
read from the tape device.  Reading of the root directory
results in storage of the entire file content from the tape,
except when the \*L-h\*O flag has been specified.
.LE
.SS "Modifier Flags"
.VL
.LI "\*L-b\*O \*Vblock_size\*O"
The argument that follows this modifier flag is used as the block size
of the tape (in kilobytes).  When this modifier flag is not
specified, \*Lrestore\*O or \*Lrrestore\*O determines tape block size
dynamically as long as the maximum number of tape blocks to be read
(blocking factor) is less than 65k.  Otherwise, include this flag with
the appropriate blocking factor.
.LI "\*L-c\*O"
Reads an old style dump tape (pre-4.2BSD file system).
.LI "\*L-d\c\*O"
Debug mode. \*Lrestore\*O or \*Lrrestore\*O performs many internal
checks about the consistency of internal structures and prints
debugging information to the standard output.
.LI "\*L-f\*O \*Vdump_file\*O"
When an argument follows the \*L-f\*O modifier flag, it is used as the
name of the archive device, replacing the default tape device
\*L/dev/rmt0h\*O.  When the argument is
the character \*L-\*O (dash), \*Lrestore\*O or \*Lrrestore\*O reads from
standard input.  Thus, \*Ldump\*O and \*Lrestore\*O or \*Lrdump\*O and
\*Lrrestore\*O may be used in a pipeline expression to copy
file systems with the following typical command:
.iS
dump  -0f  -  /usr  |  (cd /mnt;  restore  -xf  -)
.iE
.LI "\*L-F\*O \*Vcommand_file\*O"
The argument that follows the \*L-F\*O modifier flag is used as the
name of the file from which interactive input is read.  As described
in the foregoing list of \*LFunction Flags\*O for the \*L-i\*O
function flag, normally standard input is read.  The \*L-F\*O modifier
flag allows the interactive mode of the \*Lrestore\*O or
\*Lrrestore\*O command to be obtained from a previously written
command file (similar to a shell script).
.IP
In the application described here, the following are affected:
.AL
.LI
The interactive interface
.LI
A prompt for the next volume number
.LI
A prompt to set the access mode for \*L\.\*O (dot)
.LE
.IP
Error recovery interaction and the verification of operator readiness
are not affected.  For example, if the file named \*Linputfile\*O
contains the following interactive command lines (the commands are
taken from the \*LFunction Flags \*O list):
.oS
add
delete foo
add foo/bar
extract
1
yes
quit
.oE
issuing the command:
.iS
restore  -iF  inputfile
.iE
uses the interactive mode to automatically mark everything for
reading (\*Ladd\*O), to unmark the subdirectory (\*Ldelete foo\*O),
to mark the file \*Lfoo/bar\*O (\*Ladd foo/bar\*O), to read the marked
files (\*Lextract\*O), to specify volume 1 (\*L1\*O) of the
default tape, to set the access mode for dot, \*L\.\*O (\*Lyes\*O),
and then quit (\*Lquit\*O).
.LI "\*L-h\*O"
When this modifier flag is specified, \*Lrestore\*O or \*Lrrestore\*O
reads files from the specified directory, rather than files that it
references.  This prevents hierarchical restoration of complete
subtrees from the tape.
.LI "\*L-m\*O"
When this modifier is specified, \*Lrestore\*O or \*Lrrestore\*O reads
according to inode numbers rather than filename.  This read
operation is useful when only a few files are restored and you want to
avoid rewriting the complete pathname to each file.
.LI "\*L-N\*O"
Tells \*Lrestore\*O not to write to disk.  This flag does not permit the process
to act on files in the current directory.
.LI "\*L-s\*O"
The argument that follows this modifier flag is used as the number (1
is the origin) of the file to restore.  This flag is used to write more than
one dump file from the tape.
.LI "\*L-v\*O"
Normally the \*Lrestore\*O or \*Lrrestore\*O commands do not notify
you about their progress in reading from the storage device.  When this
modifier flag is used, the name of each file read from the tape
is written to the standard output device.
.LI "\*L-y\*O"
When this modifier is specified, \*Lrestore\*O or \*Lrrestore\*O
does not query whether a tape error should cause the read operation to
abort, but instead the process attempts to skip over the bad block(s)
and continue the read operation.
.LI "\*L-Y\*O"
Overwrites the existing files and links without any query.
.LI "\*L-Z\c\*O"
When this flag is used, the \*Lrestore\*O or \*Lrrestore\*O does not overwrite
existing files.
.LE
.SH DESCRIPTION
.PP
These commands read a tape or file previously written with the
\*Ldump\*O or \*Lrdump\*O command.  The \*Lrestore\*O and
\*Lrrestore\*O processes are controlled with a number of flags which
you can specify whenever files are restored from tape media.
.SS "\*Lrestore\*O"
The flags \*LbcdfhimrstvxyFNRYZ\*O consist of function flags and modifier
flags, which may be used in any logical combination, but with a preceding
\*L-\*O (dash) character.  Each group of flags contains at most one function
flags and possibly one or more modifier flags.
Function flags are \*Lirtx\*O and \*LR\*O; all other flags are modifier
flags.  Other arguments specified with these commands are the file
or subdirectory name that specifies files to be restored.  The function
and modifier flags are described under \*LFLAGS\*O.
.PP
Unless the \*L-h\*O modifier flag is specified (see the \*L-h\*O flag),
inclusion of a directory name refers to all files and
recursively, all files in all subdirectories of that directory.
.SS "\*Lrrestore\*O"
The \*Lrrestore\*O command reads files from a remote magnetic tape or
other specified storage device.  The files were previously saved to
tape with a \*Ldump\*O or \*Lrdump\*O command.  The
\*Lrrestore\*O command is identical in operation to \*Lrestore\*O,
except the \*L-f\*O function flag must be specified, and the
\*Vdump_file\*O parameter must have the form:
.iS
\*Vmachine\*O:\*Vdevice\*O
.iE
The \*Lrrestore\*O command starts remote server \*L/usr/sbin/rmt\*O
on the client machine to access the storage medium.
.SH NOTES
.PP
The \*Lrestore\*O or \*Lrrestore\*O process may become confused when doing
incremental reads from tapes that were previously written from an
active file system.
.PP
A level \*L0\*O (zero) tape \*Ldump\*O or \*Lrdump\*O must be done after a full
restore.  Because \*Lrestore\*O or \*Lrrestore\*O runs without kernel
privileges, it has no control over inode allocation; thus, a full restore
must be done to get a new set of directories that reflect new inode
numbering, even when the content of files are unchanged.
.PP
When the \*L-Y\*O flag is specified, all files, including hard and symbolic
links, are overwritten.  When the \*L-Y\*O flag is not specified, hard and
symbolic links are not overwritten, as in previous releases.
.SH DIAGNOSTICS
.PP
Detects bad flag characters.
.iX "diagnostics" "restore error"
.iX "error" "restore"
.PP
Detects read errors.  When the \*L-y\*O modifier flag has been
specified, or you respond with \*Ly\*O, the process
attempts to continue the \*Lrestore\*O operation.
.iX "restore" "diagnostics" "read error"
.PP
When a previous \*Ldump\*O or \*Lrdump\*O writes over more than one
storage device, \*Lrestore\*O or \*Lrrestore\*O asks you to change
a filled volume.
.iX "restore" "diagnostics" "full tape"
.PP
When the \*L-x\*O or \*L-i\*O function flag has been specified,
\*Lrestore\*O or \*Lrrestore\*O also asks what volume you wish to mount.
.iX "diagnostics" "volume to mount"
.PP
A fast way to read a few files is to first mount the last volume, and then
mount other previous volumes working toward the first volume.
.PP
There are numerous consistency checks that can be listed by
\*Lrestore\*O.  Most checks are self-explanatory.
.iX "diagnostics" "consistency checks"
.SS "Common Errors"
Common errors are listed as follows:
.VL
.iX "diagnostics" "common errors"
.LI "\*CConverting to new filesystem format.\*O"
A tape previously written from an old file system has been loaded.  On
reading, the old file system was automatically converted to a new
filesystem format.
.LI "\*Vfilename\*C: not found on tape\*O"
One or more filenames specified by the \*Vfilename\*O parameter was listed
in the tape directory, but was not found on the tape.  This
is caused by storage device read errors when searching for a named
file, or when a previously written tape was created on an
active file system.
.LI "\*Cexpected next file\*O \*Vinumber\*C, got \*Vinumber\*O"
A file that was not listed in the directory was detected.  This can
occur when using a tape previously created on an active
file system.
.LI "\*CIncremental tape too low\*O"
When doing incremental restore, a tape that was written before the
previous incremental tape, or one that has too low an
incremental level has been loaded.
.iX "restore" "incremental"
.LI "\*CIncremental tape too high\*O"
When doing incremental \*Lrestore\*O or \*Lrrestore\*O, a storage process
does not begin its coverage where the previous incremental tape left
off, or one that has too high an incremental level has been loaded.
.LI "\*CTape read error while restoring < \*Vfilename\*O >."
.LI "\*CTape read error while skipping over inode < \*Vinumber\*O >"
.LI "\*CTape read error while trying to resynchronize\*O"
A tape read error has occurred.  When a filename is specified, its
contents are probably partially wrong.  When an inode is being skipped,
or the tape is trying to resynchronize, no files read from tape have
been corrupted although some files may not be found on the tape.
.iX "restore" "tape read errors"
.iX "read error" "tape"
.LI "\*Cresync restore, skipped < \*Vnum\*O > blocks"
After a tape read error, \*Lrestore\*O or \*Lrrestore\*O may have to
resynchronize itself.  This message lists the number of blocks that were
skipped.
.LE
.SH FILES
.PP
.VL 4m
.LI "\*L/usr/sbin/restore\*O"
Specifies the command path
.LI "\*L/usr/sbin/rrestore\*O"
Specifies the command path
.LI "\*L/dev/rmt0h\*O"
The default storage device.
.LI "\*L/tmp/rstdir*\*O"
A file that lists directories stored on the default tape.
.LI "\*L/tmp/rstmode*\*O"
Owner, permission mode, and timestamps for stored directories.
.LI "\*L\&./restoresymtab\c\*O"
Holds information required during incremental \*Lrestore\*O or
\*Lrrestore\*O operations.
.iX "default" "tape storage device"
.iX "rmt0h"
.LE
.SH RELATED INFORMATION
.PP
Commands: \*Ldump\*O(8), \*Lrdump\*O(8), \*Lmount\*O(8), \*Lumount\*O(8),
\*Lnewfs\*O(8)
.EQ
delim off
.EN
